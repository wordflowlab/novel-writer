---
description: 定义故事规格，明确要创造什么样的作品
scripts:
  sh: .specify/scripts/bash/specify-story.sh --json
  ps: .specify/scripts/powershell/specify-story.ps1 -Json
---

用户输入描述了他们想要创作的故事。基于这个描述，创建一个完整的故事规格文档。

用户输入：
$ARGUMENTS

## 目标

像产品规格书（PRD）一样定义故事，明确"要创造什么"而非"如何创造"。输出带有 `[需要澄清]` 标记的规格，为后续澄清步骤留出空间。

## 执行步骤

### 1. 初始化故事规格

运行 `{SCRIPT}` 获取路径信息：
- 解析 JSON 获取 `STORY_NAME` 和 `SPEC_PATH`
- 如果是新故事，创建规格文件
- 如果已存在，准备更新

### 2. 检查宪法合规性

如果存在 `memory/novel-constitution.md`：
- 加载宪法原则
- 确保规格符合宪法价值观
- 在规格中引用相关原则

### 3. 创建故事规格文档

使用以下结构创建规格：

```markdown
# 故事规格书

## 元数据
- 故事名称：[名称]
- 版本：1.0.0
- 创建日期：[YYYY-MM-DD]
- 状态：草案
- 作者：[作者名]

## 一、故事概要

### 一句话故事（电梯演讲）
[30字以内描述故事核心]

### 故事简介（100-200字）
[扩展描述，包含主要冲突和结局暗示]

### 核心主题
- 主题：[如"成长"、"救赎"、"复仇"]
- 深层含义：[想要表达什么]
- 情感内核：[希望读者感受到什么]

## 二、目标定位

### 目标读者画像
- 年龄段：[需要澄清：具体年龄范围]
- 性别倾向：[需要澄清：男性向/女性向/通用]
- 阅读层次：[需要澄清：入门/进阶/资深]
- 类型偏好：[玄幻/都市/历史等]
- 阅读场景：[碎片时间/深度阅读]

### 市场定位
- 主类型：[需要澄清：爽文/悬疑/言情/严肃文学/科幻/奇幻/历史/都市/其他]
- 子类型：[具体流派，如系统流/本格推理/霸总文等]
- 类型融合：[如有，如悬疑+爱情]
- 类型标签：[主标签] + [副标签]
- 竞品分析：类似[作品1]的[特点] + [作品2]的[特点]
- 差异化：[需要澄清：核心卖点是什么]

## 三、成功标准

### 量化指标
- 目标字数：[需要澄清：3万/10万/50万]
- 更新频率：[需要澄清：日更/周更/月更]
- 完成时间：[预计时长]
- 商业目标：[如适用]

### 质量标准
- 逻辑一致性：[必须/应该]无明显漏洞
- 人物丰满度：主角有[X]个层次，配角有[Y]个层次
- 情节紧凑度：[需要澄清：每章都有冲突/允许过渡章节]
- 文字水准：[需要澄清：通俗易懂/文学性/专业性]

### 读者反馈指标
- 目标评分：[如适用]
- 互动率：[评论/收藏比例]
- 完读率：[期望的读者完成度]

## 四、核心需求

### 必须包含（P0）
1. [核心情节元素1]
2. [核心人物关系]
3. [核心冲突设定]
4. [必要的世界观元素]

### 应该包含（P1）
1. [增强体验的元素]
2. [深化主题的内容]
3. [丰富人物的支线]

### 可以包含（P2）
1. [锦上添花的内容]
2. [可选的支线]
3. [额外的彩蛋]

## 五、线索管理规格

> **多线索管理说明**：本章节定义故事的所有线索(主线、副线)及其管理策略，用于解决多线索并行推进、交汇时机控制、修改后一致性保证等问题。

### 5.1 线索定义表

定义所有故事线索的基本信息：

| 线索ID | 线索名称 | 类型 | 优先级 | 起止章节 | 核心冲突 | 主要角色 |
|-------|---------|------|--------|---------|---------|---------|
| PL-01 | [线索1名称，如"家庭线"] | 主线/支线/主线支撑 | P0/P1/P2 | [起始章-结束章] | [线索的核心冲突] | [涉及的主要角色] |
| PL-02 | [线索2名称，如"爱情线"] | 主线/支线/主线支撑 | P0/P1/P2 | [起始章-结束章] | [线索的核心冲突] | [涉及的主要角色] |

**说明**：
- 线索ID统一格式：PL-XX(Plotline的缩写)
- 类型：主线(驱动故事发展)、支线(丰富情节)、主线支撑(为主线服务)
- 优先级：P0(必须)、P1(重要)、P2(可选)

### 5.2 线索节奏规划

规划每条线索在不同阶段的活跃程度：

| 线索ID | 第一卷 | 第二卷 | 第三卷 | 第四卷 |
|-------|--------|--------|--------|--------|
| PL-01 | ⭐⭐⭐ 活跃 | ⭐⭐ 中等 | ⭐ 背景 | ⭐⭐⭐ 活跃 |
| PL-02 | ⭐⭐ 启动 | ⭐⭐⭐ 活跃 | ⭐⭐⭐ 活跃 | ⭐⭐ 收尾 |

**说明**：
- ⭐⭐⭐ 活跃：本卷重点推进，大量篇幅
- ⭐⭐ 中等：正常推进，适量篇幅
- ⭐ 背景：偶尔提及，保持存在感
- ❌ 未出场：线索尚未启动

### 5.3 线索交汇点规划

预先规划线索之间的交汇点，避免AI随意发挥：

| 交汇点ID | 章节 | 涉及线索 | 交汇内容 | 预期效果 |
|---------|------|---------|---------|---------|
| X-001 | [章节号] | PL-XX+PL-YY | [两条/多条线索如何交汇，发生什么] | [对故事和人物的影响] |
| X-002 | [章节号] | PL-XX+PL-YY+PL-ZZ | [交汇的具体内容] | [预期产生的效果] |

**说明**：
- 交汇点ID统一格式：X-XXX(Intersection的首字母)
- 涉及线索：列出所有在此处交汇的线索ID
- 交汇内容：具体的情节或事件
- 预期效果：情感冲突、情节转折、人物成长等

### 5.4 伏笔管理表

管理所有伏笔的埋设与揭晓，确保不遗漏：

| 伏笔ID | 埋设章节 | 涉及线索 | 伏笔内容 | 揭晓章节 | 揭晓方式 |
|-------|---------|---------|---------|---------|---------|
| F-001 | [章节号] | PL-XX | [埋下什么伏笔，具体内容] | [章节号] | [如何揭晓，通过什么事件] |
| F-002 | [章节号] | PL-XX+PL-YY | [跨线索的伏笔内容] | [章节号] | [揭晓方式] |

**说明**：
- 伏笔ID统一格式：F-XXX(Foreshadowing的首字母)
- 涉及线索：伏笔关联的线索，可能跨多条线索
- 埋设与揭晓的章节号必须明确，避免遗忘

### 5.5 线索修改决策矩阵

当需要修改某条线索时，必须按此流程评估影响：

**修改检查清单**：
1. 检查 5.2节：该线索在哪些卷活跃？活跃度是否需要调整？
2. 检查 5.3节：该线索涉及哪些交汇点？交汇点时机是否需要改变？
3. 检查 5.4节：该线索涉及哪些伏笔？伏笔埋设/揭晓是否需要调整？
4. 检查 creative-plan.md：哪些章节段需要同步修改？
5. 检查 tasks.md：哪些写作任务需要重新规划？
6. 检查 plot-tracker.json：当前进展如何，后续如何调整？

**示例**：假设修改PL-03(爱情线)，将某角色出场提前到第50章(原计划第100章)：
- ✅ 交汇点X-004需要提前或取消
- ✅ 第二卷的章节段活跃线索需要调整
- ✅ 相关任务的"涉及线索"字段需要更新
- ✅ 可能影响伏笔F-002的揭晓时机

### 5.6 线索一致性原则

**规划原则**：
- 每条线索必须有明确的起承转合
- 主线占用总篇幅的40-60%
- 支线不超过2-3条，避免过于分散
- 线索交汇应服务于主题，不为交汇而交汇
- 长时间休眠的线索(>20章)必须有合理理由

**验证标准**：
- [ ] 所有线索都有明确的冲突和解决方案
- [ ] 线索节奏分布合理，没有过度集中或空白
- [ ] 交汇点数量适中(建议每50章2-3个)
- [ ] 伏笔都有对应的揭晓计划
- [ ] 修改决策矩阵可操作

## 六、约束条件

### 内容红线
- 绝对禁止：[如违法内容]
- 需要避免：[如敏感话题]
- 谨慎处理：[需要澄清：如何处理情感关系]

### 创作约束
- 知识限制：[需要澄清：是否需要专业知识]
- 时间限制：[完成期限]
- 资源限制：[如需要的参考资料]

### 技术约束
- 发布平台：[需要澄清：网文平台/出版/自媒体]
- 格式要求：[章节长度等]
- 更新要求：[固定时间等]

## 七、风险评估

### 创作风险
- 写作难度：[需要澄清：挑战在哪里]
- 灵感枯竭：[如何应对]
- 逻辑漏洞：[复杂度评估]
- 多线索管理：[需要澄清：线索数量是否过多]

### 市场风险
- 同质化：[如何差异化]
- 读者接受度：[需要澄清：创新是否过度]
- 时效性：[题材是否会过时]

## 八、核心决策点 [需要澄清]

以下关键决策需要在 `/clarify` 阶段明确：
1. [决策1：如主角性格是热血还是冷静]
2. [决策2：如结局是开放还是圆满]
3. [决策3：如叙事是单线还是多线]
4. [决策4：如节奏是快速还是缓慢]
5. [决策5：如风格是轻松还是严肃]

## 九、验证清单

- [ ] 故事概要清晰明确
- [ ] 目标读者定义准确
- [ ] 成功标准可衡量
- [ ] 核心需求已列出
- [ ] 线索管理规格已定义
- [ ] 约束条件已识别
- [ ] 风险已评估
- [ ] 关键决策点已标记

## 附录：参考资料

### 灵感来源
- [来源1]
- [来源2]

### 参考作品
- [作品1]：参考其[特点]
- [作品2]：参考其[特点]

### 补充说明
[其他需要说明的内容]
```

### 4. 标记需要澄清的点

在规格中标记所有需要进一步澄清的决策点：
- 使用 `[需要澄清：具体问题]` 格式
- 确保标记 5-10 个关键决策点
- 这些将在 `/clarify` 步骤中处理

### 5. 版本管理

- 初始版本：1.0.0（草案）
- 澄清后：1.1.0（澄清版）
- 计划后：1.2.0（确认版）
- 执行中：2.0.0（执行版）

### 6. 输出和保存

- 将规格保存到 `stories/[story-name]/specification.md`
- 输出创建成功消息
- 提示下一步：运行 `/clarify` 澄清关键决策

## 注意事项

### 聚焦于 WHAT 而非 HOW
- ✅ 正确："需要一个让读者恨之入骨的反派"
- ❌ 错误："反派在第三章出场，使用倒叙手法"

### 保持规格的灵活性
- 留出澄清空间
- 不要过早确定细节
- 标记所有不确定点

### 与后续步骤的关系
- `/clarify` 将处理所有 `[需要澄清]` 标记
- `/plan` 将基于澄清后的规格制定技术方案
- `/analyze` 将验证实现是否符合规格

记住：**规格定义目标，而非路径。**