---
description: 基于任务清单执行章节写作，自动加载上下文和验证规则
argument-hint: [章节编号或任务ID]
allowed-tools: Read(//**), Write(//stories/**/content/**), Bash(ls:*), Bash(find:*), Bash(wc:*), Bash(grep:*), Bash(*)
model: claude-sonnet-4-5-20250929
scripts:
  sh: .specify/scripts/bash/check-writing-state.sh
  ps: .specify/scripts/powershell/check-writing-state.ps1
---

基于七步方法论流程执行章节写作。
---

## 前置检查

1. 运行脚本 `{SCRIPT}` 检查创作状态
2. 加载方法论基准文档：
   - **创作宪法**：`memory/novel-constitution.md`
   - **故事规格**：`stories/*/specification.md`
   - **创作计划**：`stories/*/creative-plan.md`
   - **任务清单**：`stories/*/tasks.md`
   - **前文内容**：`stories/*/content/` (如有)
   - **角色验证规则**：`spec/tracking/validation-rules.json` (如有)
   - **角色状态**：`spec/tracking/character-state.json`
   - **关系规则**：`spec/tracking/relationships.json`
   - **个人语料**：`memory/personal-voice.md`
   - **自然化表达**：`spec/knowledge/natural-expression.md`
   - **反AI检测**：`spec/presets/anti-ai-detection.md`

## 写作执行流程

### 1. 选择写作任务
从 `tasks.md` 中选择状态为 `pending` 的写作任务，标记为 `in_progress`。

### 2. 验证前置条件
- 检查相关依赖任务是否完成
- 验证必要的设定是否就绪
- 确认前序章节是否完成

### 3. 写作前提醒
**基于宪法原则提醒**：
- 核心价值观要点
- 质量标准要求
- 风格一致性准则

**基于规格要求提醒**：
- P0 必须包含的元素
- 目标读者特征
- 内容红线提醒

**分段格式规范（重要）**：
- ⛔ **禁止使用**："一"、"二"、"三"等数字标记分段
- ✅ **使用方式**：场景转换时用两个空行（一个空白行）分隔
- 📖 **原因**：数字标记过于生硬，破坏阅读沉浸感，不符合网络小说习惯

**创作强化指令（补偿编程工具低温度限制）**：

⚠️ **重要背景**：AI 编程工具（Claude Code/Cursor）默认使用低温度参数以确保代码准确性，但这会导致小说创作时出现**机械化、扁平化、缺乏情感**的问题。以下指令旨在通过显式引导补偿这一限制。

🎨 **情感与表达多样性要求**：
- **必须创造情感丰富的内容**：角色的喜怒哀乐要通过微表情、肢体语言、语气变化立体呈现
- **避免模板化描写**：拒绝"他皱起眉头"、"她叹了口气"等高频重复表达
- **使用感官细节**：视觉、听觉、触觉、嗅觉、味觉，让场景"活"起来
- **词汇多样化**：同一情绪用不同方式表达（如愤怒：咬牙、攥拳、脸色铁青、血管暴起）

💬 **对话自然化标准**：
- **拒绝说明式对话**："我很生气，因为你昨天没来" ❌
- **采用真实对话节奏**："你昨天去哪了？""……不关你的事。""不关我的事？好啊！" ✅
- **加入停顿、犹豫、省略**："我……我不是故意的，真的，你听我解释……"
- **根据人物性格调整语气**：粗鲁/儒雅/嬉皮/正经，每个角色语言独特

📖 **场景描写生动化**：
- **机械描写示例** ❌：
  > "房间很暗，他走了进去，看到一张桌子。"
- **生动描写示例** ✅：
  > "房间里弥漫着霉味，唯一的光源是窗帘缝隙透进的灰白月光。他摸索着墙壁前行，指尖触到冰冷的石壁，直到膝盖撞上桌角——一张摇摇欲坠的木桌，上面堆满灰尘。"

🔥 **冲突与张力强化**：
- **避免平铺直叙**："他们吵了一架，然后分开了" ❌
- **制造戏剧张力**："话音未落，她已转身离开。他冲上去抓住她的手腕，她猛地甩开，力道大得让自己都踉跄了一下。两人对视三秒，空气凝固，最终她头也不回地消失在走廊尽头。" ✅

🌊 **节奏变化要求**：
- **长短句交替**：避免句式单一（全是短句显得急促，全是长句显得拖沓）
- **快慢节奏切换**：行动场景（短句、急促）vs. 内心描写（长句、细腻）
- **留白的艺术**：不是所有东西都要说透，给读者想象空间

**实施要点**：
1. **每一段对话都要有独特性** - 拒绝复制粘贴式的情感表达
2. **每一个场景都要有感官细节** - 至少3种感官体验
3. **每一次冲突都要有情绪爆发点** - 不要温吞水式的矛盾
4. **定期自查**：写完一段后问自己"这段话是否足够生动？是否能让读者有画面感？"

### 4. 根据计划创作内容：
   - **开场**：吸引读者，承接前文
   - **发展**：推进情节，深化人物
   - **转折**：制造冲突或悬念
   - **收尾**：适当收束，引出下文

### 5. 质量自检
**宪法合规检查**：
- 是否符合核心价值观
- 是否达到质量标准
- 是否保持风格一致

**规格符合检查**：
- 是否包含必要元素
- 是否符合目标定位
- 是否遵守约束条件

**计划执行检查**：
- 是否按照章节架构
- 是否符合节奏设计
- 是否达到字数要求

**格式规范检查**：
- ⚠️ 确认未使用"一"、"二"、"三"等数字标记分段
- ✅ 场景转换使用两个空行（一个空白行）
- ✅ 保持段落间距自然流畅

### 6. 保存和更新
- 将章节内容保存到 `stories/*/content/`
- 更新任务状态为 `completed`
- 记录完成时间和字数

## 写作要点

- **遵循宪法**：始终符合创作原则
- **满足规格**：确保包含必要元素
- **执行计划**：按照技术方案推进
- **完成任务**：系统化推进任务清单
- **持续验证**：定期运行 `/analyze` 检查

## 完成后行动

### 7. 验证字数和更新进度

**字数统计说明**：
- 使用准确的中文字数统计方法
- 排除Markdown标记（`#`、`*`、`-`等）
- 只统计实际内容字符
- 字数要求来自 `spec/tracking/validation-rules.json`（默认2000-4000字）

**验证方法**：
使用项目提供的字数统计脚本验证章节字数：
```bash
source scripts/bash/common.sh
count_chinese_words "stories/*/content/第X章.md"
```

⚠️ **注意**：不要使用 `wc -w` 统计中文字数，它对中文极不准确！

**完成报告**：
```
✅ 章节写作完成
- 已保存：stories/*/content/第X章.md
- 实际字数：[X]字
- 字数要求：2000-4000字
- 字数状态：✅ 符合要求 / ⚠️ 字数不足 / ⚠️ 字数超出
- 任务状态：已更新
```

### 8. 建议下一步
- 继续下一个写作任务
- 每5章运行 `/analyze` 进行质量检查
- 发现问题及时调整计划

## 与方法论的关系

```
/constitution → 提供创作原则
     ↓
/specify → 定义故事需求
     ↓
/clarify → 澄清关键决策
     ↓
/plan → 制定技术方案
     ↓
/tasks → 分解执行任务
     ↓
/write → 【当前】执行写作
     ↓
/analyze → 验证质量一致
```

记住：写作是执行层，要严格遵循上层的规格和计划。