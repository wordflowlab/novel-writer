---
description: 对作品进行综合验证和分析
scripts:
  sh: .specify/scripts/bash/analyze-story.sh
  ps: .specify/scripts/powershell/analyze-story.ps1
---

对已完成的故事内容进行综合分析，验证是否符合宪法、规格和计划。

## 目标

像代码审查一样对作品进行全面验证，确保质量和一致性。

## 执行步骤

### 1. 加载验证基准

运行 `{SCRIPT}` 加载所有验证基准文档：
- 宪法文件：`memory/novel-constitution.md`
- 规格文件：`stories/*/specification.md`
- 计划文件：`stories/*/creative-plan.md`
- 任务列表：`stories/*/tasks.md`
- 已完成内容：`stories/*/content/*.md`

### 2. 宪法合规性检查

验证作品是否遵循创作宪法的原则：

```markdown
## 宪法合规性报告

### 核心价值观检查
- [ ] 原则1：[检查结果]
- [ ] 原则2：[检查结果]
- [ ] 原则3：[检查结果]

### 质量标准验证
- [ ] 逻辑一致性：[通过/警告/失败]
- [ ] 人物饱满度：[评分]
- [ ] 文字水准：[评分]

### 风格一致性
- [ ] 叙事风格：[一致/偏差]
- [ ] 语言风格：[一致/偏差]
- [ ] 节奏控制：[一致/偏差]
```

### 3. 规格符合度分析

检查实现是否满足规格要求：

```markdown
## 规格符合度分析

### 核心需求覆盖
#### P0（必须包含）
- [需求1]：✅ 已实现
- [需求2]：⚠️ 部分实现
- [需求3]：❌ 未实现

#### P1（应该包含）
[覆盖率：X%]

#### P2（可以包含）
[覆盖率：X%]

### 目标达成度
- 目标读者适配：[X%]
- 市场定位符合：[X%]
- 成功标准达成：[X/Y]

### 约束条件遵守
- 内容红线：✅ 无违规
- 创作约束：✅ 符合要求
- 技术约束：⚠️ [具体问题]
```

### 4. 计划执行分析

评估实际执行与计划的偏差：

```markdown
## 计划执行分析

### 章节架构对比
| 计划 | 实际 | 偏差分析 |
|------|------|----------|
| 第1章：开篇钩子 | ✅ 完成 | 符合预期 |
| 第2章：冲突展开 | ✅ 完成 | 略有调整 |
| 第3章：转折点 | ⚠️ 进行中 | 延后1章 |

### 人物发展轨迹
- 主角成长弧：[符合度X%]
- 配角功能：[实现度X%]
- 关系演变：[符合度X%]

### 世界观展开
- 第一层设定：✅ 按计划展开
- 第二层设定：⚠️ 提前揭示
- 第三层设定：[未到达]
```

### 5. 内容质量分析

深入分析作品质量：

```markdown
## 内容质量分析

### 文本统计
- 总字数：[X]字
- 平均章节长度：[X]字
- 完成进度：[X%]

### 结构分析
- 情节密度：[高/中/低]
- 冲突频率：[X次/章]
- 节奏变化：[图表]

### 技术问题
#### 逻辑问题
1. [位置]：[问题描述]
2. [位置]：[问题描述]

#### 连贯性问题
1. [位置]：[问题描述]

#### 人物一致性
1. [角色]：[行为矛盾点]

### 亮点识别
1. [位置]：[优秀之处]
2. [位置]：[创新点]
```

### 6. 任务完成度审计

检查任务执行情况：

```markdown
## 任务完成度

### 总体进度
- 总任务数：[X]
- 已完成：[Y]
- 进行中：[Z]
- 未开始：[W]

### 关键里程碑
- [里程碑1]：✅ 达成
- [里程碑2]：⚠️ 延期
- [里程碑3]：[待定]

### 阻塞和风险
1. [阻塞项]：[影响分析]
2. [风险项]：[应对建议]
```

### 7. 生成改进建议

基于分析结果提供具体建议：

```markdown
## 改进建议

### 紧急修复（P0）
1. **[问题]**
   - 影响：[影响描述]
   - 建议：[具体修复方案]
   - 位置：[具体章节/段落]

### 优化建议（P1）
1. **[优化项]**
   - 当前：[现状]
   - 建议：[优化方案]
   - 预期效果：[改进效果]

### 长期改进（P2）
1. **[改进方向]**
   - 理由：[为什么需要]
   - 方案：[如何实施]
   - 时机：[何时实施]
```

### 8. 生成验证报告

创建 `stories/*/analysis-report.md`：

```markdown
# 作品分析报告

## 摘要
- 分析日期：[YYYY-MM-DD]
- 分析版本：[作品版本]
- 总体评分：[X/10]
- 建议行动：[继续/修订/重写]

## 核心指标
| 维度 | 得分 | 说明 |
|------|------|------|
| 宪法合规 | X/10 | [说明] |
| 规格符合 | X/10 | [说明] |
| 计划执行 | X/10 | [说明] |
| 内容质量 | X/10 | [说明] |
| 读者体验 | X/10 | [预估] |

## 关键发现
[3-5个最重要的发现]

## 下一步行动
[基于分析的具体行动建议]
```

### 9. 交互式改进

提供交互选项：
- 查看具体问题详情
- 生成修复任务
- 更新计划
- 调整规格

### 10. 持续监控

设置质量监控机制：
- 每完成5章自动分析
- 关键节点强制分析
- 质量趋势追踪

## 分析维度框架

### 七大分析维度
1. **合规性**：符合宪法和规格
2. **一致性**：逻辑、人物、世界观
3. **完整性**：需求覆盖、任务完成
4. **质量性**：文字、结构、节奏
5. **创新性**：亮点、特色、突破
6. **可读性**：流畅、吸引、共鸣
7. **可行性**：进度、资源、风险

## 评分标准

```
10分：完美，超出预期
8-9分：优秀，小瑕疵
6-7分：良好，需优化
4-5分：及格，问题较多
1-3分：差，需要重写
```

## 与其他命令的关系

- **输入**：所有前置文档 + 实际内容
- **输出**：分析报告 + 改进建议
- **触发**：可触发任务更新、计划调整

## 注意事项

### 客观分析
- 基于数据和标准
- 避免主观臆断
- 提供具体证据

### 建设性反馈
- 问题要具体定位
- 建议要可执行
- 保持积极导向

### 持续改进
- 分析是为了改进
- 记录每次分析结果
- 追踪改进效果

记住：**分析的目的是让作品更好，而不是批判。**