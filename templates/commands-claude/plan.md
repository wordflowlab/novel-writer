---
description: 基于故事规格制定技术实现方案
argument-hint: [技术偏好和选择]
allowed-tools: Read(//stories/**/specification.md), Read(//stories/**/creative-plan.md), Write(//stories/**/creative-plan.md), Read(//memory/novel-constitution.md), Bash(find:*), Bash(grep:*), Bash(*)
model: claude-sonnet-4-5-20250929
scripts:
  sh: .specify/scripts/bash/plan-story.sh
  ps: .specify/scripts/powershell/plan-story.ps1
---

## 动态上下文加载（Claude Code 增强）

**宪法文件**：
!`test -f memory/novel-constitution.md && echo "✅ 宪法存在" || echo "⚠️  无宪法"`

**规格文件状态**：
!`find stories -name "specification.md" -exec bash -c 'echo "📄 $(dirname {})/specification.md"; grep -E "需要澄清" {} | wc -l | xargs echo "  待澄清项:"' \; 2>/dev/null`

**现有计划文件**：
!`find stories -name "creative-plan.md" 2>/dev/null`

**故事基本信息**：
!`bash {SCRIPT} 2>/dev/null | head -20 || echo "运行脚本获取故事信息"`

---

基于澄清后的故事规格，制定具体的创作技术方案。

用户输入（技术选择和偏好）：
$ARGUMENTS

## 目标

将"要创造什么"（规格）转化为"如何创造"（计划）。这是从需求到实现的关键转换。

## 执行步骤

### 1. 加载前置文档

运行 `{SCRIPT}` 检查并加载：
- 宪法文件：`memory/novel-constitution.md`
- 规格文件：`stories/*/specification.md`
- 澄清记录（如果已运行 `/clarify`）

验证规格中的 `[需要澄清]` 标记：
- 如果存在未澄清的关键决策，提示先运行 `/clarify`
- 或接受用户明确指示跳过

### 2. 制定创作计划

创建 `stories/*/creative-plan.md`，包含以下内容：

#### 2.1 写作方法选择

基于规格分析，选择最适合的写作方法：
- **三幕结构**：适合线性叙事、明确起承转合
- **英雄之旅**：适合成长型、冒险类故事
- **七点结构**：适合悬念、反转类故事
- **故事圈**：适合角色驱动、心理深度
- **混合方法**：主线+支线使用不同方法

记录选择理由和应用方式。

#### 2.2 章节架构设计

```markdown
## 章节架构

### 总体规划
- 总章数：[基于目标字数和章节长度]
- 章节长度：[2000-3000字/章]
- 分卷安排：[如适用]

### 结构映射
[根据选定方法，映射关键节点到具体章节]

### 线索分布规划

**重要**：从specification.md第五章读取线索管理规格，在每个卷/章节段标注活跃线索。

#### 第一卷：[卷名](章节范围)

| 章节段 | 内容 | 关键事件 | **活跃线索** | **交汇点** |
|--------|------|---------|-------------|-----------|
| [X-Y章] | [段落内容] | [关键事件列表] | PL-01⭐⭐⭐、PL-02⭐⭐ | X-001(第X章) |
| [X-Y章] | [段落内容] | [关键事件列表] | PL-01⭐⭐、PL-03⭐⭐⭐ | 无 |

**线索标注说明**：
- PL-XX：线索ID，来自specification.md 5.1节
- ⭐⭐⭐ 主推进：本章节段重点推进此线索，占据主要篇幅
- ⭐⭐ 辅助：正常推进，有一定篇幅
- ⭐ 背景：偶尔提及，保持存在感
- X-XXX：交汇点ID，来自specification.md 5.3节

#### 第二卷：[卷名](章节范围)

[重复上述表格结构]

### 节奏设计
- 开篇钩子：第[X]章
- 第一个高潮：第[X]章
- 中点转折：第[X]章
- 最大危机：第[X]章
- 最终高潮：第[X]章
```

#### 2.3 人物体系设计

```markdown
## 人物体系

### 主角设计
- 初始状态：[起点]
- 成长弧线：[变化轨迹]
- 核心冲突：[内在vs外在]
- 关键转变点：[具体章节]

### 配角功能
[每个重要配角的功能定位和出场计划]

### 关系网络
[人物关系图和演变计划]
```

#### 2.4 世界观构建

```markdown
## 世界观体系

### 核心设定
- 世界规则：[物理/魔法/科技规则]
- 社会结构：[政治/经济/文化]
- 历史背景：[重要历史事件]

### 设定展开计划
- 第一层（开篇）：[基础设定]
- 第二层（发展）：[深入设定]
- 第三层（高潮）：[核心秘密]
```

#### 2.5 情节技术设计

```markdown
## 情节技术

### 冲突升级路径
1. 初级冲突：[个人层面]
2. 中级冲突：[团体层面]
3. 高级冲突：[世界层面]

### 悬念设置
- 主悬念：[贯穿全文]
- 章节悬念：[每章钩子]
- 支线悬念：[丰富层次]

### 伏笔布局
[伏笔清单和回收计划]
```

#### 2.6 叙事技术选择

```markdown
## 叙事技术

### POV设计
- 视角类型：[第一/第三人称]
- 视角限制：[全知/限定]
- 多视角安排：[如适用]

### 时间线设计
- 主线时间：[线性/非线性]
- 回忆穿插：[使用策略]
- 平行叙事：[如适用]

### 叙事节奏
- 快节奏段落：[动作/冲突]
- 慢节奏段落：[情感/描写]
- 节奏变化：[张弛规律]
```

### 3. 技术决策记录

记录所有重要的技术决策：
- **决策**：选择了什么
- **理由**：为什么选择
- **风险**：可能的问题
- **备案**：替代方案

### 4. 质量保证计划

```markdown
## 质量保证

### 自检清单
- [ ] 逻辑一致性检查点
- [ ] 人物行为合理性
- [ ] 世界观自洽性
- [ ] 节奏流畅性

### 验证节点
- 每5章：小循环验证
- 每卷：大循环验证
- 完稿：全面验证
```

### 5. 风险管理

识别并制定应对策略：
- **创作风险**：灵感、逻辑、节奏
- **技术风险**：复杂度、一致性
- **时间风险**：进度、质量平衡

### 6. 输出和验证

- 保存计划到 `stories/*/creative-plan.md`
- 验证计划符合宪法原则
- 验证计划满足规格需求
- 提示下一步：运行 `/tasks` 生成任务

## 与其他命令的关系

- **输入**：来自 `/specify` 的规格 + `/clarify` 的澄清
- **输出**：为 `/tasks` 提供任务生成依据
- **验证**：被 `/analyze` 用于检查实现符合度

## 注意事项

### 技术服务于故事
- 所有技术选择都要服务于故事表达
- 不要为了技巧而技巧
- 保持方案的灵活性

### 可执行性
- 计划要具体可执行
- 避免过于理想化
- 考虑实际创作能力

### 迭代优化
- 计划可以根据实践调整
- 记录调整原因和影响
- 保持版本追踪

记住：**好的计划是成功的一半，但要随时准备调整。**
