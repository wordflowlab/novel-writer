description = "检查世界观设定的一致性和完整性"

prompt = """
检查世界观设定，确保逻辑自洽和完整。

用户要求：{{args}}

## 执行步骤

### 1. 收集世界观设定
读取相关文件：
- spec/knowledge/world-setting.md
- spec/knowledge/locations.md
- 使用 glob_files 查找 "stories/**/story.md" (世界观部分)
- 使用 glob_files 查找 "stories/**/chapters/**/*.md" (场景描写)

### 2. 执行一致性检查

**地理逻辑**
```
地理检查：
□ 地点距离是否合理
□ 地形描述是否一致
□ 气候季节是否匹配
□ 方位关系是否正确
```

**规则体系**
```
规则检查：
□ 魔法/科技规则一致性
□ 社会制度前后统一
□ 经济体系逻辑合理
□ 文化习俗保持一致
```

**时代背景**
```
时代检查：
□ 科技水平统一
□ 历史事件连贯
□ 语言用词恰当
□ 生活细节符合
```

### 3. 发现的问题

**地理矛盾**
```
问题1：距离不一致
- 第3章：城市A到B需要3天
- 第8章：同样路程只要1天
建议：统一为2天路程
```

**规则冲突**
```
问题2：能力设定矛盾
- 初期设定：魔法需要咒语
- 第10章：无咒语施法
建议：解释为高级技巧
```

**时代错误**
```
问题3：科技水平不符
- 设定：中世纪背景
- 第5章：出现现代物品
建议：删除或改为相应时代物品
```

### 4. 完整性检查

**设定完成度**
```
世界观完整度：75%

已设定：
✅ 地理环境
✅ 政治体系
✅ 经济结构
⚠️ 文化风俗（部分）
❌ 历史背景（缺失）
❌ 语言体系（缺失）
```

**需要补充**
```
建议补充设定：
1. 历史大事年表
2. 主要势力关系
3. 货币体系
4. 节日习俗
5. 特色用语
```

### 5. 生成检查报告

# 世界观检查报告

## 一致性评分：85/100

### 优秀方面
- 地理设定详实
- 主要规则清晰
- 核心逻辑自洽

### 发现问题
[列出所有问题]

### 改进建议
1. 优先级高：[问题]
2. 优先级中：[问题]
3. 优先级低：[问题]

## 完整性评分：75/100

### 需要补充
[列出缺失部分]

### 补充建议
[具体补充方案]

### 6. 提供修复方案
为每个问题提供具体修改建议：
- 修改位置
- 修改内容
- 替代方案

### 7. 完成报告
✅ 世界观检查完成！
- 一致性：[分数]/100
- 完整性：[分数]/100
- 发现问题：[数量]
- 建议：优先[行动]

## 注意事项
- 保持设定文档更新
- 写作时查阅设定
- 定期运行检查
- 逐步完善世界观
"""